<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Dr Sanna</title> 
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="preload" href="/icones/arrow-left-solid.svg" as="image">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
           <style>
  #loader {
  transition: all 0.3s ease-out;
  opacity: 1;
  visibility: visible;
  position: fixed;
  height: 100vh;
  width: 100vw;
  background: black;
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

#loader.fadeOut {
  opacity: 0;
  visibility: hidden;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

body {
  font-family: 'Roboto', sans-serif;
  display: flex;
background: #292d33
}

#title-container {
  width: 33.33%;
  max-height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: white;
background: #1A1A1A;
box-shadow: 10px 0px 15px rgba(0, 0, 0, 0.2);
}

#table-container {
  width: 66.67%;
  max-height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  padding: 50px;
}

table {
  border-collapse: separate;
  width: 100%;
  height: 100%;
}

td {
  background-color: #434952;
  box-sizing: border-box;
  overflow: hidden;
  position: relative;
  z-index: 0;
font-size: 15px;
}

.cell-content {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  word-wrap: break-word;
  font-weight: bold;
  transition: none;
}

.square-cell {
  width: calc(100% - 20px);
  height: calc(100% - 20px);
  padding: 10px;
  position: relative;
}

.square-cell .cell-content {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}

#title-container td {
  border: 1px solid black;
  background-color: #434952;
  color: white;
border-radius: 5px;
}

#title-container tr:first-child .cell-content {
  font-size: 1.2em;
    font-family: "Roboto", sans-serif;
  font-weight: bold; /* ou 700 pour Roboto Bold */
}

#table-container > table {
  border-collapse: separate;
  width: 100%;
  height: 100%;
border-spacing: 5px;
}

#table-container td {
border-radius: 5px;
  position: relative;
  z-index: 0;
  border: 2px solid transparent;
box-sizing: border-box;
color: white;
}

#table-container td:hover {
  cursor: pointer;
  transform: scale(1.25) translateZ(0);
  border: 2px solid black;
  border-radius: 25px;
  outline: 5px solid gold;
  z-index: 1;
  background-color: #434952;
}

#table-container tr .cell-content {
  text-transform: none;
  font-family: "Roboto", sans-serif;
  font-weight: 400; /* pour Roboto Light */
}

.cell-content a {
  text-decoration: none;
  color: inherit;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cell-content a:hover {
  background-color: transparent;
}

.arrow-left-icon {
  width: 8em;
  height: 8em; 
}
.hidden {
  display: none;
}
.content-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
}

.content-image {
  height: 100px;  /* Remplacez par la hauteur souhaitée */
  width: 120px;   /* Remplacez par la largeur souhaitée */
  object-fit: contain; /* Assure que l'image soit redimensionnée de manière à s'ajuster à la taille donnée tout en maintenant son aspect */
 margin-top: 20px;
}
.content-text {
  text-align: center;
  margin-top: 10px;
  margin-left: 20px;  /* Ajoute une marge à l'intérieur de la gauche de la cellule */
  margin-right: 20px;  /* Ajoute une marge à l'intérieur de la droite de la cellule */
  height: 40px;  // Ceci fixera la hauteur du texte à 40px
  overflow: hidden;  // Ceci cachera tout texte qui dépasserait de cette zone
}

</style>
</head>
<body>
   <div id="loader">
       <div style="text-align:center; color: white;">
         <img src="https://i.giphy.com/media/Rk3PlFCDTXAKBjWUvR/giphy.webp" alt="Loading...">
         <p id="loaderStatus">Initialisation...</p>
       </div>
    </div>
    <div id="title-container">
        <table>
        <tr>
            <td style="height: 33.33%;">
                <div id="dr-sanna-cell" class="cell-content">DR SANNA'S COURSES TOOL</div>
            </td>
        </tr>
            <tr>
                <td style="height: 66.67%;"><div class="cell-content"></div></td>
            </tr>
        </table>
    </div>
    <div id="table-container">
        <table>
            <tr>
                <td class="square-cell" id="cell-1"><div class="cell-content"></div></td>
                <td class="square-cell" id="cell-2"><div class="cell-content"></div></td>
                <td class="square-cell" id="cell-3"><div class="cell-content"></div></td>
            </tr>
            <tr>
                <td class="square-cell" id="cell-4"><div class="cell-content"></div></td>
                <td class="square-cell" id="cell-5"><div class="cell-content"></div></td>
                <td class="square-cell" id="cell-6"><div class="cell-content"></div></td>
            </tr>
            <tr>
                <td class="square-cell" id="cell-7"><div class="cell-content"></div></td>
                <td class="square-cell" id="cell-8"><div class="cell-content"></div></td>
                <td class="square-cell" id="cell-9"><div class="cell-content"></div></td>
            </tr>
        </table>
    </div>

    <script>
    const imageFileNames = []; // Liste des noms de fichiers d'images à précharger
    let imagesLoaded = 0;

    let menuStack = []; // Pile pour stocker les menus visités
    let currentMenu = {}; // Menu actuellement affiché
    let initialTitle = ''; // Titre initial de dr-sanna-cell
    let isSubMenuActive = false; // Indique si un sous-menu est actuellement affiché

function preloadImages() {
  return new Promise((resolve) => {
    for (let i = 0; i < imageFileNames.length; i++) {
      const imageSrc = imageFileNames[i];
      const image = new Image();
      image.onload = function () {
        imagesLoaded++;
        $("#loaderStatus").text(`Chargement des images ${imagesLoaded} sur ${imageFileNames.length}`);
        if (imagesLoaded === imageFileNames.length) {
          $("#loaderStatus").text("Images chargées, mise à jour des cellules...");
          resolve();
        }
      };
      image.src = imageSrc;
    }
  });
}

    $(document).ready(function () {
      $.getJSON("/data/MainMenu.json", function (data) {
        const cellDataMap = {};
        data.forEach((item) => {
          cellDataMap[item["1"]] = item;
          for (let i = 2; i <= 10; i++) {
            const cellDataItem = item[i.toString()];
            if (cellDataItem && cellDataItem.hasOwnProperty("image") && cellDataItem.image) {
              imageFileNames.push(cellDataItem.image);
            }
          }
        });

        currentMenu = cellDataMap["MainMenu"];

        initialTitle = $("#dr-sanna-cell").text(); // Sauvegarder le titre initial de dr-sanna-cell

        for (let i = 1; i <= 9; i++) {
          $(`#cell-${i}`).addClass("no-border-background");
          $(`#cell-${i}`).click(function () {
            const cellData = cellDataMap[`cell-${i}`];
            if (cellData) {
              const index = i + 1;
              const cellDataItem = currentMenu[index.toString()];
              if (isBackButton(cellDataItem)) {
                goBack();
              } else if (isSubMenu(cellDataItem) && !isSubMenuActive) {
                for (let j = 1; j <= 9; j++) {
                  $(`#cell-${j}`).removeClass("no-border-background");
                }
                navigateToSubMenu(cellData, cellDataItem);
              } else if (cellDataItem.hasOwnProperty("link") && cellDataItem.link) {
                window.open(cellDataItem.link, '_blank');
              }
            }
          });
        }

        // Précharger les images, puis mettre à jour les cellules
        preloadImages().then(() => {
          updateCells(currentMenu);
        });
      });

function updateCells(cellData) {
    for (let j = 1; j <= 9; j++) {
      $("#loaderStatus").text(`Mise à jour des cellules ${j} sur 9`); // Ajout d'un message de statut de chargement
      $(`#cell-${j} .cell-content`).empty();
      $(`#cell-${j}`).css("visibility", "visible");
    }
    for (let j = 1; j <= 9; j++) {

      const cellContentElement = $(`#cell-${j} .cell-content`);
      const cellDataItem = cellData[j + 1];
      if (cellDataItem) {
        if (
          typeof cellDataItem === "object" &&
          cellDataItem.hasOwnProperty("text") &&
          cellDataItem.hasOwnProperty("image")
        ) {
          if (cellDataItem.text) {
            const imageSrc = cellDataItem.image;
            const image = $("<img>")
              .addClass("content-image")
              .attr("src", imageSrc);
            const text = $("<span>")
              .addClass("content-text")
              .text(cellDataItem.text);
            const content = $("<div>")
              .addClass("content-container")
              .append(image)
              .append(text);
            cellContentElement.empty().append(content);
          } else {
            $(`#cell-${j}`).css("visibility", "hidden");
          }
        } else if (isBackButton(cellDataItem)) {
          const icon = $("<img>")
            .attr("src", "/icones/arrow-left-solid.svg")
            .addClass("arrow-left-icon");
          cellContentElement.empty().append(icon);
        }
      } else {
        $(`#cell-${j}`).css("visibility", "hidden");
      }
    }
    $("#loaderStatus").text("Chargement terminé, apparition d'un menu incroyable..."); // Ajout d'un message de statut de chargement
    // Après avoir terminé la mise à jour des cellules, faites disparaître le loader
    $("#loader").fadeOut("slow", function() {
      $("#loaderStatus").text(""); // Efface le message de statut de chargement une fois le chargement terminé
    });
  }

      function navigateToSubMenu(subMenu, subMenuTitle) {
        menuStack.push({ menu: currentMenu, title: $("#dr-sanna-cell").text() });
        currentMenu = subMenu;
        updateCells(subMenu);
        $("#dr-sanna-cell").text(subMenuTitle.text);
        isSubMenuActive = true;
      }

      function goBack() {
        if (menuStack.length > 0) {
          const previousMenu = menuStack.pop();
          currentMenu = previousMenu.menu;
          updateCells(currentMenu);
          $("#dr-sanna-cell").text(previousMenu.title);
          isSubMenuActive = false;
        }
      }

      function isBackButton(cellDataItem) {
        return cellDataItem === "/icones/arrow-left-solid.svg";
      }

      function isSubMenu(cellDataItem) {
        return (
          typeof cellDataItem === "object" &&
          cellDataItem.hasOwnProperty("text") &&
          cellDataItem.hasOwnProperty("image")
        );
      }
    });
    </script>
</body>
</html>

